import{n as x,ai as ce,d5 as pe,h as H,j as g,m as Q,d6 as C,k as B,aI as ke,q as A,r as z,I as Y,a as h,c as S,w as _,A as P,a8 as Ee,a7 as Ce,B as y,e as t,aF as fe,P as R,a0 as b,b as L,az as N,d as E,E as O,d7 as $e,t as q,C as Re,d8 as Fe,d9 as we,M as Pe,cx as Se,ab as Le,at as Ue,D as K,l as Te,cv as Z,da as ee,db as Be,ag as Oe,dc as De,s as te,ak as Ne,z as je,O as Ae,d0 as He,aQ as se,aB as ae,a1 as ze,dd as qe,i as Me,u as Ke,_ as Ve}from"./CqK3pOxO.js";import{_ as Ie}from"./mbInPATW.js";import{E as Xe}from"./Bl9z_itj.js";import{a as V}from"./B_YUyEoF.js";import{b as Ge}from"./Db9tVfb4.js";import{i as We}from"./DoGKehV4.js";import{E as Je}from"./BUGIQZCH.js";import{_ as Qe}from"./BQ2erpLX.js";import"./DB9HkSSx.js";import"./YZ-g8RTx.js";import"./bhowzwNK.js";import"./DNcfcRXs.js";var Ye=1,Ze=4;function oe(o){return Ge(o,Ye|Ze)}const me=Symbol("uploadContextKey"),xe="ElUpload";class et extends Error{constructor(l,s,u,i){super(l),this.name="UploadAjaxError",this.status=s,this.method=u,this.url=i}}function ne(o,l,s){let u;return s.response?u="".concat(s.response.error||s.response):s.responseText?u="".concat(s.responseText):u="fail to ".concat(l.method," ").concat(o," ").concat(s.status),new et(u,s.status,l.method,o)}function tt(o){const l=o.responseText||o.response;if(!l)return l;try{return JSON.parse(l)}catch(s){return l}}const st=o=>{typeof XMLHttpRequest>"u"&&x(xe,"XMLHttpRequest is undefined");const l=new XMLHttpRequest,s=o.action;l.upload&&l.upload.addEventListener("progress",d=>{const c=d;c.percent=d.total>0?d.loaded/d.total*100:0,o.onProgress(c)});const u=new FormData;if(o.data)for(const[d,c]of Object.entries(o.data))ce(c)&&c.length?u.append(d,...c):u.append(d,c);u.append(o.filename,o.file,o.file.name),l.addEventListener("error",()=>{o.onError(ne(s,o,l))}),l.addEventListener("load",()=>{if(l.status<200||l.status>=300)return o.onError(ne(s,o,l));o.onSuccess(tt(l))}),l.open(o.method,s,!0),o.withCredentials&&"withCredentials"in l&&(l.withCredentials=!0);const i=o.headers||{};if(i instanceof Headers)i.forEach((d,c)=>l.setRequestHeader(c,d));else for(const[d,c]of Object.entries(i))pe(c)||l.setRequestHeader(d,String(c));return l.send(u),l},ve=["text","picture","picture-card"];let at=1;const M=()=>Date.now()+at++,ge=H({action:{type:String,default:"#"},headers:{type:g(Object)},method:{type:String,default:"post"},data:{type:g([Object,Function,Promise]),default:()=>Q({})},multiple:Boolean,name:{type:String,default:"file"},drag:Boolean,withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},fileList:{type:g(Array),default:()=>Q([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:ve,default:"text"},httpRequest:{type:g(Function),default:st},disabled:Boolean,limit:Number}),ot=H({...ge,beforeUpload:{type:g(Function),default:C},beforeRemove:{type:g(Function)},onRemove:{type:g(Function),default:C},onChange:{type:g(Function),default:C},onPreview:{type:g(Function),default:C},onSuccess:{type:g(Function),default:C},onProgress:{type:g(Function),default:C},onError:{type:g(Function),default:C},onExceed:{type:g(Function),default:C},crossorigin:{type:g(String)}}),nt=H({files:{type:g(Array),default:()=>Q([])},disabled:{type:Boolean,default:!1},handlePreview:{type:g(Function),default:C},listType:{type:String,values:ve,default:"text"},crossorigin:{type:g(String)}}),lt={remove:o=>!!o},rt=B({name:"ElUploadList"}),it=B({...rt,props:nt,emits:lt,setup(o,{emit:l}){const s=o,{t:u}=ke(),i=A("upload"),d=A("icon"),c=A("list"),m=V(),v=z(!1),k=Y(()=>[i.b("list"),i.bm("list",s.listType),i.is("disabled",s.disabled)]),$=f=>{l("remove",f)};return(f,U)=>(h(),S(Ue,{tag:"ul",class:y(t(k)),name:t(c).b()},{default:_(()=>[(h(!0),P(Ee,null,Ce(f.files,(a,n)=>(h(),P("li",{key:a.uid||a.name,class:y([t(i).be("list","item"),t(i).is(a.status),{focusing:v.value}]),tabindex:"0",onKeydown:fe(e=>!t(m)&&$(a),["delete"]),onFocus:e=>v.value=!0,onBlur:e=>v.value=!1,onClick:e=>v.value=!1},[R(f.$slots,"default",{file:a,index:n},()=>[f.listType==="picture"||a.status!=="uploading"&&f.listType==="picture-card"?(h(),P("img",{key:0,class:y(t(i).be("list","item-thumbnail")),src:a.url,crossorigin:f.crossorigin,alt:""},null,10,["src","crossorigin"])):b("v-if",!0),a.status==="uploading"||f.listType!=="picture-card"?(h(),P("div",{key:1,class:y(t(i).be("list","item-info"))},[L("a",{class:y(t(i).be("list","item-name")),onClick:N(e=>f.handlePreview(a),["prevent"])},[E(t(O),{class:y(t(d).m("document"))},{default:_(()=>[E(t($e))]),_:1},8,["class"]),L("span",{class:y(t(i).be("list","item-file-name")),title:a.name},q(a.name),11,["title"])],10,["onClick"]),a.status==="uploading"?(h(),S(t(Xe),{key:0,type:f.listType==="picture-card"?"circle":"line","stroke-width":f.listType==="picture-card"?6:2,percentage:Number(a.percentage),style:Re(f.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):b("v-if",!0)],2)):b("v-if",!0),L("label",{class:y(t(i).be("list","item-status-label"))},[f.listType==="text"?(h(),S(t(O),{key:0,class:y([t(d).m("upload-success"),t(d).m("circle-check")])},{default:_(()=>[E(t(Fe))]),_:1},8,["class"])):["picture-card","picture"].includes(f.listType)?(h(),S(t(O),{key:1,class:y([t(d).m("upload-success"),t(d).m("check")])},{default:_(()=>[E(t(we))]),_:1},8,["class"])):b("v-if",!0)],2),t(m)?b("v-if",!0):(h(),S(t(O),{key:2,class:y(t(d).m("close")),onClick:e=>$(a)},{default:_(()=>[E(t(Pe))]),_:2},1032,["class","onClick"])),b(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),b(" This is a bug which needs to be fixed "),b(" TODO: Fix the incorrect navigation interaction "),t(m)?b("v-if",!0):(h(),P("i",{key:3,class:y(t(d).m("close-tip"))},q(t(u)("el.upload.deleteTip")),3)),f.listType==="picture-card"?(h(),P("span",{key:4,class:y(t(i).be("list","item-actions"))},[L("span",{class:y(t(i).be("list","item-preview")),onClick:e=>f.handlePreview(a)},[E(t(O),{class:y(t(d).m("zoom-in"))},{default:_(()=>[E(t(Se))]),_:1},8,["class"])],10,["onClick"]),t(m)?b("v-if",!0):(h(),P("span",{key:0,class:y(t(i).be("list","item-delete")),onClick:e=>$(a)},[E(t(O),{class:y(t(d).m("delete"))},{default:_(()=>[E(t(Le))]),_:1},8,["class"])],10,["onClick"]))],2)):b("v-if",!0)])],42,["onKeydown","onFocus","onBlur","onClick"]))),128)),R(f.$slots,"append")]),_:3},8,["class","name"]))}});var le=K(it,[["__file","upload-list.vue"]]);const ut=H({disabled:{type:Boolean,default:!1}}),dt={file:o=>ce(o)},ye="ElUploadDrag",ct=B({name:ye}),pt=B({...ct,props:ut,emits:dt,setup(o,{emit:l}){Te(me)||x(ye,"usage: <el-upload><el-upload-dragger /></el-upload>");const u=A("upload"),i=z(!1),d=V(),c=v=>{if(d.value)return;i.value=!1,v.stopPropagation();const k=Array.from(v.dataTransfer.files);l("file",k)},m=()=>{d.value||(i.value=!0)};return(v,k)=>(h(),P("div",{class:y([t(u).b("dragger"),t(u).is("dragover",i.value)]),onDrop:N(c,["prevent"]),onDragover:N(m,["prevent"]),onDragleave:N($=>i.value=!1,["prevent"])},[R(v.$slots,"default")],42,["onDrop","onDragover","onDragleave"]))}});var ft=K(pt,[["__file","upload-dragger.vue"]]);const mt=H({...ge,beforeUpload:{type:g(Function),default:C},onRemove:{type:g(Function),default:C},onStart:{type:g(Function),default:C},onSuccess:{type:g(Function),default:C},onProgress:{type:g(Function),default:C},onError:{type:g(Function),default:C},onExceed:{type:g(Function),default:C}}),vt=B({name:"ElUploadContent",inheritAttrs:!1}),gt=B({...vt,props:mt,setup(o,{expose:l}){const s=o,u=A("upload"),i=V(),d=Z({}),c=Z(),m=e=>{if(e.length===0)return;const{autoUpload:p,limit:r,fileList:F,multiple:w,onStart:T,onExceed:I}=s;if(r&&F.length+e.length>r){I(e,F);return}w||(e=e.slice(0,1));for(const X of e){const j=X;j.uid=M(),T(j),p&&v(j)}},v=async e=>{if(c.value.value="",!s.beforeUpload)return $(e);let p,r={};try{const w=s.data,T=s.beforeUpload(e);r=ee(s.data)?oe(s.data):s.data,p=await T,ee(s.data)&&We(w,r)&&(r=oe(s.data))}catch(w){p=!1}if(p===!1){s.onRemove(e);return}let F=e;p instanceof Blob&&(p instanceof File?F=p:F=new File([p],e.name,{type:e.type})),$(Object.assign(F,{uid:e.uid}),r)},k=async(e,p)=>Oe(e)?e(p):e,$=async(e,p)=>{const{headers:r,data:F,method:w,withCredentials:T,name:I,action:X,onProgress:j,onSuccess:he,onError:be,httpRequest:_e}=s;try{p=await k(p!=null?p:F,e)}catch(D){s.onRemove(e);return}const{uid:G}=e,W={headers:r||{},withCredentials:T,file:e,data:p,method:w,filename:I,action:X,onProgress:D=>{j(D,e)},onSuccess:D=>{he(D,e),delete d.value[G]},onError:D=>{be(D,e),delete d.value[G]}},J=_e(W);d.value[G]=J,J instanceof Promise&&J.then(W.onSuccess,W.onError)},f=e=>{const p=e.target.files;p&&m(Array.from(p))},U=()=>{i.value||(c.value.value="",c.value.click())},a=()=>{U()};return l({abort:e=>{Be(d.value).filter(e?([r])=>String(e.uid)===r:()=>!0).forEach(([r,F])=>{F instanceof XMLHttpRequest&&F.abort(),delete d.value[r]})},upload:v}),(e,p)=>(h(),P("div",{class:y([t(u).b(),t(u).m(e.listType),t(u).is("drag",e.drag),t(u).is("disabled",t(i))]),tabindex:t(i)?"-1":"0",onClick:U,onKeydown:fe(N(a,["self"]),["enter","space"])},[e.drag?(h(),S(ft,{key:0,disabled:t(i),onFile:m},{default:_(()=>[R(e.$slots,"default")]),_:3},8,["disabled"])):R(e.$slots,"default",{key:1}),L("input",{ref_key:"inputRef",ref:c,class:y(t(u).e("input")),name:e.name,disabled:t(i),multiple:e.multiple,accept:e.accept,type:"file",onChange:f,onClick:N(()=>{},["stop"])},null,42,["name","disabled","multiple","accept","onClick"])],42,["tabindex","onKeydown"]))}});var re=K(gt,[["__file","upload-content.vue"]]);const ie="ElUpload",ue=o=>{var l;(l=o.url)!=null&&l.startsWith("blob:")&&URL.revokeObjectURL(o.url)},yt=(o,l)=>{const s=De(o,"fileList",void 0,{passive:!0}),u=a=>s.value.find(n=>n.uid===a.uid);function i(a){var n;(n=l.value)==null||n.abort(a)}function d(a=["ready","uploading","success","fail"]){s.value=s.value.filter(n=>!a.includes(n.status))}function c(a){s.value=s.value.filter(n=>n!==a)}const m=(a,n)=>{const e=u(n);e&&(console.error(a),e.status="fail",c(e),o.onError(a,e,s.value),o.onChange(e,s.value))},v=(a,n)=>{const e=u(n);e&&(o.onProgress(a,e,s.value),e.status="uploading",e.percentage=Math.round(a.percent))},k=(a,n)=>{const e=u(n);e&&(e.status="success",e.response=a,o.onSuccess(a,e,s.value),o.onChange(e,s.value))},$=a=>{pe(a.uid)&&(a.uid=M());const n={name:a.name,percentage:0,status:"ready",size:a.size,raw:a,uid:a.uid};if(o.listType==="picture-card"||o.listType==="picture")try{n.url=URL.createObjectURL(a)}catch(e){Ne(ie,e.message),o.onError(e,n,s.value)}s.value=[...s.value,n],o.onChange(n,s.value)},f=async a=>{const n=a instanceof File?u(a):a;n||x(ie,"file to be removed not found");const e=p=>{i(p),c(p),o.onRemove(p,s.value),ue(p)};o.beforeRemove?await o.beforeRemove(n,s.value)!==!1&&e(n):e(n)};function U(){s.value.filter(({status:a})=>a==="ready").forEach(({raw:a})=>{var n;return a&&((n=l.value)==null?void 0:n.upload(a))})}return te(()=>o.listType,a=>{a!=="picture-card"&&a!=="picture"||(s.value=s.value.map(n=>{const{raw:e,url:p}=n;if(!p&&e)try{n.url=URL.createObjectURL(e)}catch(r){o.onError(r,n,s.value)}return n}))}),te(s,a=>{for(const n of a)n.uid||(n.uid=M()),n.status||(n.status="success")},{immediate:!0,deep:!0}),{uploadFiles:s,abort:i,clearFiles:d,handleError:m,handleProgress:v,handleStart:$,handleSuccess:k,handleRemove:f,submit:U,revokeFileObjectURL:ue}},ht=B({name:"ElUpload"}),bt=B({...ht,props:ot,setup(o,{expose:l}){const s=o,u=V(),i=Z(),{abort:d,submit:c,clearFiles:m,uploadFiles:v,handleStart:k,handleError:$,handleRemove:f,handleSuccess:U,handleProgress:a,revokeFileObjectURL:n}=yt(s,i),e=Y(()=>s.listType==="picture-card"),p=Y(()=>({...s,fileList:v.value,onStart:k,onProgress:a,onSuccess:U,onError:$,onRemove:f}));return je(()=>{v.value.forEach(n)}),Ae(me,{accept:He(s,"accept")}),l({abort:d,submit:c,clearFiles:m,handleStart:k,handleRemove:f}),(r,F)=>(h(),P("div",null,[t(e)&&r.showFileList?(h(),S(le,{key:0,disabled:t(u),"list-type":r.listType,files:t(v),crossorigin:r.crossorigin,"handle-preview":r.onPreview,onRemove:t(f)},se({append:_(()=>[E(re,ae({ref_key:"uploadRef",ref:i},t(p)),{default:_(()=>[r.$slots.trigger?R(r.$slots,"trigger",{key:0}):b("v-if",!0),!r.$slots.trigger&&r.$slots.default?R(r.$slots,"default",{key:1}):b("v-if",!0)]),_:3},16)]),_:2},[r.$slots.file?{name:"default",fn:_(({file:w,index:T})=>[R(r.$slots,"file",{file:w,index:T})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):b("v-if",!0),!t(e)||t(e)&&!r.showFileList?(h(),S(re,ae({key:1,ref_key:"uploadRef",ref:i},t(p)),{default:_(()=>[r.$slots.trigger?R(r.$slots,"trigger",{key:0}):b("v-if",!0),!r.$slots.trigger&&r.$slots.default?R(r.$slots,"default",{key:1}):b("v-if",!0)]),_:3},16)):b("v-if",!0),r.$slots.trigger?R(r.$slots,"default",{key:2}):b("v-if",!0),R(r.$slots,"tip"),!t(e)&&r.showFileList?(h(),S(le,{key:3,disabled:t(u),"list-type":r.listType,files:t(v),crossorigin:r.crossorigin,"handle-preview":r.onPreview,onRemove:t(f)},se({_:2},[r.$slots.file?{name:"default",fn:_(({file:w,index:T})=>[R(r.$slots,"file",{file:w,index:T})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):b("v-if",!0)]))}});var _t=K(bt,[["__file","upload.vue"]]);const kt=ze(_t),Et={Base64结果:"Base64 string result"},Ct={Base64结果:"Base64结果"},$t={Base64结果:"Base64結果"},de={en_US:Et,zh_Hans_CN:Ct,zh_Hant_HK:$t},Rt={class:"el-upload__text"},Ft={class:"label mt-20 flex space-x-20 items-center justify-start"},Ht={__name:"pic2base64",setup(o){const l=c=>{const v=Ke().$lang.value||"zh_Hans_CN",k=de[v]||de.zh_Hans_CN||{};return k[c]===void 0?c:k[c]},s=z(),u=z(""),i=c=>{s.value.clearFiles();const m=c[0];m.uid=M(),s.value.handleStart(m)},d=c=>{const m=new FileReader;m.onload=function(v){u.value=v.target.result.toString()},m.readAsDataURL(c.raw)};return(c,m)=>{const v=O,k=Ie,$=kt,f=Ve,U=Je,a=Qe;return h(),S(a,{class:"p-pic2base64"},{default:_(()=>[m[2]||(m[2]=L("p",{class:"label"},"Upload image",-1)),E($,{ref_key:"upload",ref:s,limit:1,"on-exceed":i,"auto-upload":!1,"list-type":"picture",drag:"","on-change":d},{default:_(()=>[E(v,{class:"el-icon--upload"},{default:_(()=>[E(t(qe))]),_:1}),L("div",Rt,[E(k,{text:"Drag file here or [a]click to upload[/a]"},{a:_(()=>m[1]||(m[1]=[L("em",null,q("click to upload"),-1)])),_:1})])]),_:1},512),L("div",Ft,[L("span",null,q(l("Base64结果")),1),E(f,{msg:t(u)},null,8,["msg"])]),E(U,{modelValue:t(u),"onUpdate:modelValue":m[0]||(m[0]=n=>Me(u)?u.value=n:null),type:"textarea",rows:7,resize:"none",class:"text-primary"},null,8,["modelValue"])]),_:1})}}};export{Ht as default};
